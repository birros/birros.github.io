(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{405:function(t,e,s){"use strict";s.r(e);var n=s(45),r=Object(n.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("Petit récapitulatif de mes expérimentations avec OpenStreetMap et OpenMapTiles.")]),t._v(" "),s("h2",{attrs:{id:"introduction"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),s("p",[t._v("Le but de la manœuvre est de pouvoir consulter hors ligne des cartes issues du\nprojet "),s("a",{attrs:{href:"https://fr.wikipedia.org/wiki/OpenStreetMap",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenStreetMap"),s("OutboundLink")],1),t._v(" sur mon ordinateur portable. J'ai jeté mon dévolu sur les\noutils mis en place par "),s("a",{attrs:{href:"https://openmaptiles.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenMapTiles (en)"),s("OutboundLink")],1),t._v(", ceux-ci étant libres et plutôt\nperformants, tout du moins dans une certaine mesure. "),s("a",{attrs:{href:"https://fr.wikipedia.org/wiki/OsmAnd",target:"_blank",rel:"noopener noreferrer"}},[t._v("OmsAnd"),s("OutboundLink")],1),t._v(" et "),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Maps.me",target:"_blank",rel:"noopener noreferrer"}},[t._v("Maps.me (en)"),s("OutboundLink")],1),t._v("\nme faisant de l’œil mais leur utilisation en tant que logiciel bureau n'est pas\ndu tout aboutie.")]),t._v(" "),s("p",[s("strong",[t._v("Cette mise en œuvre a une principale limitation, ne servir que des tuiles et\nne pas fournir de service de planification d'itinéraire ou de recherche de\nlieu.")])]),t._v(" "),s("h2",{attrs:{id:"obtenir-les-cartes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#obtenir-les-cartes"}},[t._v("#")]),t._v(" Obtenir les cartes")]),t._v(" "),s("p",[t._v("Les cartes se présentent sous le format "),s("code",[t._v("mbtiles")]),t._v(", deux méthodes existent pour\nles obtenir:")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("Recommandée (inscription requise)")]),t._v(": télécharger des "),s("a",{attrs:{href:"https://openmaptiles.com/downloads/",target:"_blank",rel:"noopener noreferrer"}},[t._v("cartes (en)"),s("OutboundLink")],1),t._v(" sur le\nsite d'OpenMapTiles")]),t._v(" "),s("li",[t._v("En les générant depuis des fichiers "),s("code",[t._v("osm.pbf")]),t._v(" téléchargés depuis "),s("a",{attrs:{href:"https://download.geofabrik.de/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Geofabrik\n(en)"),s("OutboundLink")],1),t._v(". La encore deux solutions existent:")]),t._v(" "),s("li",[t._v("La méthode recommandée par "),s("strong",[t._v("OpenMapTiles")]),t._v(", non testée car très lourde par\ncontre offrant des cartes totalement compatibles avec le serveur: "),s("a",{attrs:{href:"https://openmaptiles.org/docs/generate/generate-openmaptiles/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Générer ses\npropres cartes (en)"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("En utilisant un petit outil en ligne de commande d'un développeur\nindépendant au projet. Cependant obtenir une carte aussi complète que les\nprécédentes semble compliqué: "),s("a",{attrs:{href:"https://github.com/systemed/tilemaker",target:"_blank",rel:"noopener noreferrer"}},[t._v("tilemaker (en)"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"configuration-du-serveur"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-du-serveur"}},[t._v("#")]),t._v(" Configuration du serveur")]),t._v(" "),s("p",[t._v("Le serveur peut être directement lancé sans nécessiter de configuration dès\nmaintenant, cependant sans définir quel style utiliser, les données des cartes\napparaîtront en brut. Il faut alors "),s("strong",[t._v("créer un dossier")]),t._v(" ayant cette\narchitecture, en prenant soin de placer les cartes "),s("code",[t._v("mbtiles")]),t._v(" dans le dossier\nportant le même nom:")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(".\n├── config.json\n├── styles\n│   └── osm-bright\n├── fonts\n└── mbtiles\n")])])]),s("p",[t._v("Le fichier "),s("code",[t._v("config.json")]),t._v(" se définit comme ceci:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"options"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"paths"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"styles"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"styles"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"fonts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fonts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"mbtiles"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mbtiles"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"styles"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"osm-bright"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"style"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"osm-bright/style-local.json"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"tilejson"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"overlay"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"bounds"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.686256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42.32197")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.847979")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("44.97821")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"center"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.47855")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("43.29512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"data"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"2017-07-03_france_languedoc-roussillon"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"mbtiles"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2017-07-03_france_languedoc-roussillon.mbtiles"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("La valeur de "),s("code",[t._v("bounds")]),t._v(" peut être choisie en utilisant l'outil "),s("a",{attrs:{href:"http://boundingbox.klokantech.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("BoundingBox (en)"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("Ensuite il faut télécharger le style "),s("a",{attrs:{href:"https://github.com/openmaptiles/osm-bright-gl-style/releases/tag/v1.6",target:"_blank",rel:"noopener noreferrer"}},[t._v("osm-bright (en)"),s("OutboundLink")],1),t._v(" et le placer dans le\ndossier "),s("code",[t._v("styles/osm-bright")]),t._v(", puis renseigner la carte à utiliser au sein du\nfichier "),s("code",[t._v("styles/osm-bright/style-local.json")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sources"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"openmaptiles"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vector"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mbtiles://2017-07-03_france_languedoc-roussillon.mbtiles"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Et enfin installer les polices de caractères "),s("a",{attrs:{href:"https://github.com/openmaptiles/fonts/releases/tag/v2.0",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenMapTiles fonts (en)"),s("OutboundLink")],1),t._v(" dans le\ndossier "),s("code",[t._v("fonts")]),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"lancement-du-serveur"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lancement-du-serveur"}},[t._v("#")]),t._v(" Lancement du serveur")]),t._v(" "),s("p",[t._v("Pour lancer le serveur, depuis le dossier préalablement construit, il suffit\nd'utiliser la commande qui suit, détaillée sur la page d'accueil du dépôt de\n"),s("a",{attrs:{href:"https://github.com/klokantech/tileserver-gl",target:"_blank",rel:"noopener noreferrer"}},[t._v("tileserver-gl (en)"),s("OutboundLink")],1),t._v(". Les cartes sont alors servies aussi bien au format "),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Vector_tiles",target:"_blank",rel:"noopener noreferrer"}},[t._v("vector\ntiles (en)"),s("OutboundLink")],1),t._v(" que "),s("a",{attrs:{href:"https://fr.wikipedia.org/wiki/Portable_Network_Graphics",target:"_blank",rel:"noopener noreferrer"}},[t._v("PNG"),s("OutboundLink")],1),t._v(" à l'adresse suivante: "),s("code",[t._v("http://localhost:8080")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker run --rm -it -v "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("pwd")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(":/data -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(":80 klokantech/tileserver-gl\n")])])]),s("p",[s("strong",[t._v("Si "),s("a",{attrs:{href:"https://fr.wikipedia.org/wiki/SELinux",target:"_blank",rel:"noopener noreferrer"}},[t._v("SELinux"),s("OutboundLink")],1),t._v(" est présent sur votre système, penser à le désactiver en lançant\nceci:")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("setenforce "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Et Pour réactiver SELinux:")]),t._v("\nsetenforce "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);